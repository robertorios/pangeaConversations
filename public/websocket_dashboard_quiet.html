<!DOCTYPE html>
<html>
<head>
    <title>WebSocket Monitor Dashboard (Quiet Mode)</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .stats { background: #f5f5f5; padding: 15px; border-radius: 5px; margin: 10px 0; }
        .connection { background: #e8f4fd; padding: 10px; margin: 5px 0; border-radius: 3px; }
        .timestamp { color: #666; font-size: 12px; }
        .auto-refresh { margin: 20px 0; }
        .manual-refresh { margin: 10px 0; }
        button { padding: 8px 16px; margin: 5px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; }
        button:hover { background: #0056b3; }
    </style>
</head>
<body>
    <h1>ðŸ”Œ WebSocket Monitor Dashboard (Quiet Mode)</h1>
    
    <div class="manual-refresh">
        <button onclick="fetchStats()">ðŸ”„ Refresh Now</button>
        <button onclick="stopAllConnections()">ðŸ›‘ Stop All Connections</button>
    </div>
    
    <div class="auto-refresh">
        <label>
            <input type="checkbox" id="autoRefresh"> Auto-refresh every 5 minutes (quiet mode)
        </label>
    </div>
    
    <div id="stats"></div>
    <div id="connections"></div>
    
    <script>
        function fetchStats() {
            fetch('/websocket/stats')
                .then(response => response.json())
                .then(data => {
                    document.getElementById('stats').innerHTML = `
                        <div class="stats">
                            <h3>ðŸ“Š Overall Statistics</h3>
                            <p><strong>Total Connections:</strong> ${data.total_connections}</p>
                            <p><strong>Total Subscriptions:</strong> ${data.total_subscriptions}</p>
                            <p><strong>Channels:</strong> ${Object.keys(data.channels).join(', ')}</p>
                            <p class="timestamp">Last updated: ${new Date(data.timestamp).toLocaleString()}</p>
                        </div>
                    `;
                })
                .catch(error => console.error('Error fetching stats:', error));
                
            fetch('/websocket/status')
                .then(response => response.json())
                .then(data => {
                    const connectionsHtml = data.connections.map(conn => `
                        <div class="connection">
                            <strong>Connection ID:</strong> ${conn.id}<br>
                            <strong>Subscriptions:</strong> ${conn.subscriptions}<br>
                            <strong>Channels:</strong> ${conn.channels.join(', ')}
                        </div>
                    `).join('');
                    
                    document.getElementById('connections').innerHTML = `
                        <div class="stats">
                            <h3>ðŸ”— Active Connections</h3>
                            ${connectionsHtml}
                        </div>
                    `;
                })
                .catch(error => console.error('Error fetching connections:', error));
        }
        
        function stopAllConnections() {
            fetch('/websocket/stop_all', { method: 'POST' })
                .then(response => response.json())
                .then(data => {
                    alert(data.message);
                    fetchStats(); // Refresh after stopping
                })
                .catch(error => console.error('Error stopping connections:', error));
        }
        
        // Initial load
        fetchStats();
        
        // Auto-refresh (disabled by default, 5-minute intervals)
        let refreshInterval;
        document.getElementById('autoRefresh').addEventListener('change', function() {
            if (this.checked) {
                refreshInterval = setInterval(fetchStats, 300000); // 5 minutes (300 seconds)
            } else {
                clearInterval(refreshInterval);
            }
        });
    </script>
</body>
</html>
